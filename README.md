# SARC
Static Analysis Report Combiner (SARC) merges reports from various static code analysis tools.

## Index
1. [Prerequisites](#Prerequisites)
2. [Compiling](#Compiling)
3. [Executing](#Executing)
4. [Usage](#usage)
    1. [Dotfiles](#Dotfiles)
        1. [.properties](#.properties)
        2. [.config](#.config)
    2. [Scripts](#Scripts)
    3. [Flags](#Flags)
    4. [Templates](#Templates)
5. [Design Docs](#DesignDocs)
    1. [Class Diagram](#ClassDiagram)
    2. [Sequence Diagram](#SequenceDiagram)

## Prerequisites
The project makes use of a batch file in order to build the source files and hence, the target system must have a Windows environment.
Furthermore, the target system must have Java (>=1.8) installed and available in the system path.

## Compiling
In the root directory of the project, a batch file by the name "AutoBuildTest.bat" is present. 
Run the batch file in the command line and it will compile the sources and execute the test cases.  
```
./../SARC> AutoBuildTest.bat
```  
Once the batch file has sucessfully executed, you should be able to see a `Build Success` message.

## Executing
Once the batch file has been run, a binary will be generated in the root folder and it will have the name `SARC.jar`.
In order to run the application, open the commandline and copy paste the below line.  
```
java -jar SARC.jar
```  
Check the following section for more details.

## Usage
### Dotfiles
By default, the application looks for certain files in the dotfiles folder. This folder can be found under the resources directory in the root folder. Dotfiles contains 3 files of interest to the application. 
* .options
* .config
* .properties

The .options file is meant to be left untouched by the user. It defines commmandline options for the application. 

The other two files are meant to be created/modified by the user. The .config file should contain the list of tools to be executed by the application and the .properties file contains key-value pairs that can be used in the .config file.

#### .properties
The properties file should contain key-value pairs separated by the equals symbol. Note that there shouldn't be any spaces between the key and the equals sign and between the equals sign and the value. Make sure the key text starts at the beginning of each line. 

An example .properties file  
```
path="C:/Users/JohnDoe/"
id=1
command=new file
```

NOTE: Any path value needs to be written with '/' as the separating character. Also, if the path ends in a directory, do not give a slash at the end.

#### .config
The .config file is a JSON file with a JSONArray being the root element. The JSONArray will contain JSONObjects of the following structure 
```
{
    "command" : "java -jar ${path} ${command}",
    "callback" : "scripts.js:main"
}
```  
Each JSONObject corrsponds to an analysis tool. The JSONObject should have only two attributes : command and callback. The command key should hold the command to be executed by the application. Note that the string value for the command is a template string. The values will be substituted by looking up the .properties file. The ${path} and ${command} will be replaced by the values of the path and command keys in the .properties file respectively.

The callback key's value is a a name of a JavaScript file and a function in the same file. The JavaScript function will be called by the application after the command has been executed. The output of the command will be passed as argument to the function.

### Scripts
Under the Resources folder, a Scripts folder can be found where the user is supposed to place any and all JavaScript files to be used by the application. Each JSONObject in the .config file has two keys: command and callback. The application runs the command and the output generated by the command needs to be normalized into a particular format for the application to then proceed with the merging of data. The task of normalizing the output falls on the user. The user needs to define a JavaScript function that will take a string argument and return a JSONObject of the following format  
```
{
    "tool" : "toolname",
    "FullPathToFile1" : [
        {
            "line" : "linenumber",
            "comment" : "description"
        },
        {
            "line" : "linenumber",
            "comment" : "description"
        }
    ],
    "FullPathToFile2" : [
        {
            "line" : "linenumber",
            "comment" : "description"
        }
    ]
}
```

The tool attribute should contain the name of the tool. The other attributes in the root JSONObject should be the absolute path of the file being analysed and its value should be a JSONArray holding objects with only two attributes: line and comment. The line attribute should have the line number and the comment should have the description of the error for that line.

The JavaScript function needs to be defined in a JavaScript file that needs to be placed in the Scripts folder under the Resources directory. If the function depends on any other function for execution, those functions need to be defined in the same file as the application only compiles files mentioned in the callback(in .config). As of now, in the callback value, only one JavaScript file can be mentioned.  

### Flags
```
usage: SARC
 -c,--configuration <arg>   path to the configuration file
 -f,--configformat <arg>    format of the configuration file(JSON)
 -h,--help                  display help and quit
 -o,--outputformat <arg>    generate report in particular
                            format(stdout/plaint_text/html)
 -s,--startmerge            generate and report merge
```

### Templates
The templates folder contains the templates for the html report generation. There are two files in this directory: 
* indextemplate.txt
* reporttemplate.txt

The indextemplate.txt file contains the template for creating the index page of the report. The reporttemplate.txt contains the template that will be used to create an html report for each source file analysed. 

## DesignDocs
### Class Diagram
![Class Diagram](/resources/images/classDiagram.png "Class Diagram")
### Sequence diagram
![Sequence Diagram](/resources/images/sequenceDiagram.png "Sequence Diagram")